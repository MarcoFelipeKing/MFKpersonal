<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO METADATA -->
    <meta name="description" content="Portfolio of Dr. Marco-Felipe King, Lecturer in Building Engineering & Infection Transmission. Director of WPE Research Group. Researching CFD, Indoor Air Quality, and COVID-19 safety.">
    <meta name="keywords" content="Marco-Felipe King, Leeds, CFD, Infection Control, Indoor Air Quality, SAGE, Bioaerosols, WPE Leeds">
    <meta name="author" content="Dr. Marco-Felipe King">
    <meta property="og:title" content="Dr. Marco-Felipe King | Director WPE Leeds">
    <meta property="og:image" content="images/MFK_2025.jpg">

    <title>Dr. Marco-Felipe King | Director WPE & Lecturer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Apache ECharts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <!-- ECharts Core -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <!-- ECharts WordCloud Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"></script>
    <style>
        :root {
            --primary: #1a365d;
            --primary-light: #2c5282;
            --accent: #3182ce;
            --accent-light: #63b3ed;
            --text: #1a202c;
            --text-light: #4a5568;
            --text-muted: #718096;
            --bg: #ffffff;
            --bg-alt: #f7fafc;
            --bg-card: #ffffff;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --wpe-blue: #77AAD4;
            --wpe-navy: #6F8AC6;
            --wpe-charcoal: #535254;
            --wpe-lavender: #9F90C5;
            --wpe-teal: #8AC9C1;
        }

        [data-theme="dark"] {
            --primary: #90cdf4;
            --primary-light: #63b3ed;
            --accent: #63b3ed;
            --accent-light: #90cdf4;
            --text: #f7fafc;
            --text-light: #e2e8f0;
            --text-muted: #a0aec0;
            --bg: #0f1729;
            --bg-alt: #1a202c;
            --bg-card: #1e2a3a;
            --border: #2d3748;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); line-height: 1.7; transition: var(--transition); }

        /* Navigation */
        nav { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; background: rgba(255, 255, 255, 0.9); border-bottom: 1px solid var(--border); backdrop-filter: blur(10px); }
        [data-theme="dark"] nav { background: rgba(15, 23, 41, 0.9); }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; }
        .nav-logo { font-family: 'Playfair Display', serif; font-size: 1.5rem; font-weight: 700; color: var(--primary); text-decoration: none; }
        .nav-links { display: flex; gap: 2rem; list-style: none; align-items: center; }
        .nav-links a { color: var(--text-light); text-decoration: none; font-size: 0.95rem; font-weight: 500; transition: var(--transition); position: relative; }
        .nav-links a:hover { color: var(--accent); }
        .theme-toggle { background: var(--bg-alt); border: 1px solid var(--border); padding: 0.5rem; border-radius: 50%; cursor: pointer; color: var(--text); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }
        .mobile-menu-btn { display: none; background: none; border: none; font-size: 1.5rem; color: var(--text); cursor: pointer; }

        /* Hero Section */
        .hero { min-height: 90vh; display: flex; align-items: center; padding: 8rem 2rem 4rem; background: linear-gradient(135deg, var(--bg) 0%, var(--bg-alt) 100%); position: relative; overflow: hidden; }
        .hero-container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 4rem; align-items: center; position: relative; z-index: 1; }
        .hero-content h1 { font-family: 'Playfair Display', serif; font-size: 3.5rem; font-weight: 700; line-height: 1.2; margin-bottom: 0.5rem; color: var(--primary); }
        .hero-content .subtitle { font-size: 1.25rem; color: var(--accent); margin-bottom: 1.5rem; font-weight: 500; }
        .hero-content p { font-size: 1.1rem; color: var(--text-light); margin-bottom: 2rem; max-width: 500px; }
        
        .hero-stats { display: flex; gap: 3rem; margin-bottom: 2rem; }
        .stat-number { font-size: 2.5rem; font-weight: 700; color: var(--primary); display: block; text-align: center; }
        .stat-label { font-size: 0.85rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; display: block; text-align: center; }
        
        .hero-buttons { display: flex; gap: 1rem; flex-wrap: wrap; }
        .btn { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.875rem 1.75rem; border-radius: 8px; font-weight: 600; font-size: 0.95rem; text-decoration: none; transition: var(--transition); cursor: pointer; border: none; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { background: var(--primary); transform: translateY(-2px); box-shadow: var(--shadow-lg); }
        .btn-secondary { background: transparent; color: var(--text); border: 2px solid var(--border); }
        .btn-secondary:hover { border-color: var(--accent); color: var(--accent); }
        .btn-wpe {
            background: var(--wpe-navy);
            color: white;
            font-weight: 700;
            border-radius: 30px;
            padding: 0.9rem 2rem;
            transition: all 0.3s ease;
            }
            .btn-wpe:hover {
            background: var(--wpe-teal);
            color: var(--wpe-charcoal);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
            }
        .hero-image-wrapper { position: relative; width: 400px; height: 400px; margin: 0 auto; }
        .hero-image-wrapper img { width: 100%; height: 100%; object-fit: cover; border-radius: 20px; box-shadow: var(--shadow-lg); }

        /* LOGO STRIP STYLES */
        .logo-strip { background: var(--bg); padding: 2rem 0; border-bottom: 1px solid var(--border); }
        .logo-text { text-align: center; font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1.5rem; text-transform: uppercase; letter-spacing: 1px; }
        .logo-grid { display: flex; justify-content: center; align-items: center; gap: 3rem; flex-wrap: wrap; }
        .org-logo { height: 60px; width: auto; object-fit: contain; filter: grayscale(100%); opacity: 0.7; transition: all 0.3s ease; }
        .logo-grid:hover .org-logo { filter: grayscale(0%); opacity: 1; }
        [data-theme="dark"] .org-logo { filter: grayscale(100%) invert(1); }
        [data-theme="dark"] .logo-grid:hover .org-logo { filter: invert(0); }

        /* WPE LEADERSHIP SECTION */

        .wpe-section {
        background: linear-gradient(135deg, var(--wpe-teal) 0%, var(--wpe-blue) 50%, var(--wpe-lavender) 100%);
        color: var(--wpe-charcoal);
        position: relative;
        overflow: hidden;
        }

        .wpe-section::after {
        content: '';
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2), transparent 70%);
        pointer-events: none;
        }
        .wpe-section {
            background: linear-gradient(135deg, rgba(138, 201, 193,0.94), rgba(159, 144, 197,0.94)),
                        url('images/cfd_SilsoePic1.png') center/cover no-repeat;
            }
        .wpe-section::before { pointer-events: none; }  
        .wpe-section::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M54.627 0l.83.828-1.415 1.415-.828-.828-.828.828-1.415-1.415.828-.828-.828-.828 1.415-1.415.828.828.828-.828 1.415 1.415-.828.828zM22.485 0l.83.828-1.415 1.415-.828-.828-.828.828-1.415-1.415.828-.828-.828-.828 1.415-1.415.828.828.828-.828 1.415 1.415-.828.828zM0 22.485l.828.83-1.415 1.415-.828-.828-.828.828L-3.658 22.485l.828-.828-.828-.828 1.415-1.415.828.828.828-.828 1.415 1.415-.828.828zM0 54.627l.828.83-1.415 1.415-.828-.828-.828.828L-3.658 54.627l.828-.828-.828-.828 1.415-1.415.828.828.828-.828 1.415 1.415-.828.828z' fill='%23ffffff' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E"); }
        .wpe-header { text-align: center; margin-bottom: 3rem; position: relative; z-index: 2; }
        .wpe-header h2 {
        color: var(--wpe-navy);
        letter-spacing: 1px;
        }

        .wpe-header p {
        color: var(--wpe-charcoal);
        opacity: 0.85;
        }

        .wpe-stat-num { color: var(--wpe-lavender); }
        .wpe-stats { display: flex; justify-content: center; gap: 3rem; margin: 2rem 0; }
        .wpe-stat { text-align: center; background: rgba(255,255,255,0.1); padding: 1rem 2rem; border-radius: 12px; backdrop-filter: blur(5px); }
        .wpe-stat-num { display: block; font-size: 2rem; font-weight: 700; color: var(--accent-light); }
        
        .wpe-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem; position: relative; z-index: 2; }
        .wpe-card { background: rgba(255,255,255,0.1); padding: 1.5rem 1rem; border-radius: 12px; text-align: center; transition: var(--transition); border: 1px solid rgba(255,255,255,0.1); }
        .wpe-card:hover { background: rgba(255,255,255,0.2); transform: translateY(-5px); }
        .wpe-card i { color: currentColor; opacity: 0.8; }
        .wpe-card h3 { font-size: 1rem; margin-bottom: 0.5rem; color: white; }
        .wpe-card p { font-size: 0.8rem; opacity: 0.8; line-height: 1.4; }
        .wpe-card {
        background: rgba(255,255,255,0.85);
        color: var(--wpe-charcoal);
        transition: all 0.4s ease;
        border-top: 4px solid transparent;
        box-shadow: 0 4px 8px rgba(0,0,0,0.08);
        }
        .wpe-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }

        .wpe-card[data-topic="air"] { border-color: var(--wpe-blue); }
        .wpe-card[data-topic="biores"] { border-color: var(--wpe-navy); }
        .wpe-card[data-topic="health"] { border-color: var(--wpe-lavender); }
        .wpe-card[data-topic="sanitation"] { border-color: var(--wpe-charcoal); }
        .wpe-card[data-topic="water"] { border-color: var(--wpe-teal); }

        /* LATEST ACTIVITY STYLES */
        .news-banner { background: var(--bg-alt); padding: 1.5rem 0; border-bottom: 1px solid var(--border); }
        .news-container { max-width: 1200px; margin: 0 auto; padding: 0 2rem; display: flex; align-items: center; gap: 2rem; }
        .news-label { font-weight: 700; color: var(--accent); text-transform: uppercase; font-size: 0.85rem; white-space: nowrap; }
        .news-item { display: flex; align-items: center; gap: 1rem; color: var(--text-light); font-size: 0.95rem; }
        .news-date { background: var(--bg-card); border: 1px solid var(--border); padding: 0.2rem 0.6rem; border-radius: 4px; font-size: 0.8rem; font-weight: 600; }

        /* Sections General */
        section { padding: 6rem 2rem; }
        .section-container { max-width: 1200px; margin: 0 auto; }
        .section-header { text-align: center; margin-bottom: 4rem; }
        .section-header h2 { font-family: 'Playfair Display', serif; font-size: 2.5rem; color: var(--primary); margin-bottom: 1rem; }
        .section-divider { width: 60px; height: 4px; background: var(--accent); margin: 1rem auto 0; border-radius: 2px; }

        /* HBN & About */
        .about-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 4rem; }
        .hbn-card { background: var(--bg-card); border-radius: 16px; padding: 2rem; border: 1px solid var(--border); border-left: 5px solid #2ecc71; box-shadow: var(--shadow); margin-top: 1rem; }
        .hbn-card h4 { color: var(--text); font-size: 1.2rem; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }
        .hbn-card-role { display: inline-block; background: rgba(46, 204, 113, 0.15); color: #27ae60; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 700; margin-bottom: 1rem; }
        .hbn-link { color: var(--accent); font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; margin-top: 1rem; }

        /* MEDIA / CFD VIDEOS SECTION */
        .media-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem; }
        .video-card { background: var(--bg-card); border-radius: 16px; overflow: hidden; box-shadow: var(--shadow); border: 1px solid var(--border); }
        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
        .video-caption { padding: 1.5rem; }
        .video-caption h3 { font-size: 1.1rem; margin-bottom: 0.5rem; }
        .video-caption p { font-size: 0.9rem; color: var(--text-muted); }

        /* PHD TEAM GRID */
        .team-section { background: var(--bg-alt); }
        .team-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 2rem; margin-top: 2rem; }
        .team-member { text-align: center; background: var(--bg-card); padding: 1.5rem; border-radius: 16px; border: 1px solid var(--border); transition: var(--transition); }
        .team-member:hover { transform: translateY(-5px); box-shadow: var(--shadow-lg); border-color: var(--accent); }
        .member-photo { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 1rem; border: 3px solid var(--bg-alt); box-shadow: var(--shadow); }
        .member-name { font-weight: 600; color: var(--text); font-size: 1.1rem; margin-bottom: 0.25rem; }
        .member-topic { font-size: 0.85rem; color: var(--accent); font-weight: 500; margin-bottom: 0.5rem; }
        .member-bio { font-size: 0.8rem; color: var(--text-muted); line-height: 1.5; }

        /* Vis Section */
        .vis-container { background: var(--bg-card); border-radius: 16px; padding: 1.5rem; border: 1px solid var(--border); box-shadow: var(--shadow); height: 500px; position: relative; }
        .vis-title { position: absolute; top: 1.5rem; left: 1.5rem; z-index: 10; font-size: 1.1rem; font-weight: 600; color: var(--text-light); background: rgba(255,255,255,0.8); padding: 0.25rem 0.5rem; border-radius: 4px; }
        
        /* Contact/Footer */
        .contact { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); color: white; }
        .contact-card { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border-radius: 16px; padding: 2rem; text-align: center; }
        footer { background: var(--bg-alt); padding: 3rem 2rem; text-align: center; border-top: 1px solid var(--border); }
        .footer-social a { width: 45px; height: 45px; background: var(--bg); border: 1px solid var(--border); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--text); margin: 0 0.5rem; text-decoration: none; }

        /* Mobile */
        @media (max-width: 1024px) {
            .wpe-grid { grid-template-columns: repeat(3, 1fr); }
        }
        @media (max-width: 768px) {
            .hero-container, .about-grid, .media-grid, .vis-grid { grid-template-columns: 1fr; }
            .wpe-grid { grid-template-columns: repeat(2, 1fr); }
            .hero-image-wrapper { width: 300px; height: 300px; }
            .nav-links { display: none; } 
            .mobile-menu-btn { display: block; }
            .news-container { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
        }
        @media (max-width: 480px) {
            .wpe-grid { grid-template-columns: 1fr; }
            .wpe-stats { flex-direction: column; gap: 1rem; }
        }
        /* Stats Bar */
        .stats-bar {
            display: flex;
            gap: 2rem;
            justify-content: center;
            margin: 2rem 0;
            padding: 1.5rem;
            background: var(--card-bg);
            border-radius: 12px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            display: block;
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Timeline Controls */
        .timeline-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .period-btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid var(--border-color);
            background: transparent;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .period-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .period-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        /* Theme Cards */
        .themes-section {
            margin-top: 3rem;
        }

        .theme-clusters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .theme-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid var(--theme-color);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .theme-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }

        .theme-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .theme-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .theme-keywords {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }

        .theme-count {
            font-size: 0.9rem;
            color: var(--theme-color);
            font-weight: 600;
        }

        /* Collaborator Ranking */
        #collaboratorRanking {
            max-height: 500px;
            overflow-y: auto;
        }

        .collab-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: var(--card-bg);
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .collab-item:hover {
            background: var(--hover-bg);
            transform: translateX(5px);
        }

        .collab-rank {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-secondary);
            min-width: 30px;
        }

        .collab-info {
            flex: 1;
        }

        .collab-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .collab-bar {
            height: 6px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .collab-papers {
            font-size: 0.9rem;
            font-weight: 600;
            color: #667eea;
        }

        /* ========================================
        PUBLICATIONS SECTION
        ======================================== */

        .publications-section {
            padding: 5rem 0;
            background: var(--bg);
        }

        /* Controls: Search + Filters */
        .pub-controls {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .pub-search {
            position: relative;
            max-width: 400px;
        }

        .pub-search i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .pub-search input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-card);
            color: var(--text);
            font-size: 0.95rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .pub-search input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
        }

        .pub-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .pub-filter-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: 20px;
            background: var(--bg-card);
            color: var(--text-muted);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pub-filter-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .pub-filter-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        /* Publication List */
        .pub-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* Publication Card */
        .pub-card {
            position: relative;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .pub-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .pub-card.featured {
            border-left: 4px solid var(--accent);
        }

        .pub-card.hidden {
            display: none;
        }

        /* Badge */
        .pub-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: linear-gradient(135deg, #FFD93D, #FF6B6B);
            color: #1a1a2e;
            font-size: 0.7rem;
            font-weight: 700;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Title */
        .pub-title {
            font-size: 1.1rem;
            font-weight: 600;
            line-height: 1.4;
            margin-bottom: 0.75rem;
            padding-right: 6rem; /* Space for badge */
        }

        .pub-title a {
            color: var(--text);
            text-decoration: none;
            transition: color 0.2s;
        }

        .pub-title a:hover {
            color: var(--accent);
        }

        /* Authors */
        .pub-authors {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        .pub-authors strong {
            color: var(--primary);
        }

        /* Venue (Journal info) */
        .pub-venue {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        .pub-venue i {
            color: var(--accent);
            margin-right: 0.5rem;
        }

        .pub-meta {
            opacity: 0.7;
        }

        /* Abstract Toggle */
        .pub-abstract {
            margin-bottom: 1rem;
        }

        .abstract-toggle {
            background: none;
            border: none;
            color: var(--accent);
            font-size: 0.85rem;
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: color 0.2s;
        }

        .abstract-toggle:hover {
            color: var(--primary);
        }

        .abstract-toggle i {
            transition: transform 0.3s;
            font-size: 0.7rem;
        }

        .abstract-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease, padding 0.3s ease;
        }

        .abstract-content p {
            padding-top: 0.75rem;
            font-size: 0.9rem;
            line-height: 1.7;
            color: var(--text-light);
            border-left: 2px solid var(--border);
            padding-left: 1rem;
            margin: 0;
        }

        .pub-abstract.open .abstract-toggle i {
            transform: rotate(180deg);
        }

        .pub-abstract.open .abstract-content {
            max-height: 500px;
        }

        /* Metrics */
        .pub-metrics {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.8rem;
        }

        .pub-citations {
            color: var(--text-muted);
        }

        .pub-citations i {
            margin-right: 0.3rem;
            color: var(--accent);
        }

        .pub-access {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .pub-access.open-access {
            color: #27ae60;
        }

        .pub-access.open-access i {
            color: #27ae60;
        }

        /* Action Buttons */
        .pub-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .pub-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: transparent;
            color: var(--text-muted);
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pub-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
            background: rgba(78, 205, 196, 0.05);
        }

        .pub-btn i {
            font-size: 0.75rem;
        }

        /* Copy confirmation animation */
        .pub-btn.copied {
            border-color: #27ae60;
            color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
        }

        /* Footer */
        .pub-footer {
            text-align: center;
            margin-top: 2.5rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .pub-title {
                font-size: 1rem;
                padding-right: 0;
            }
            
            .pub-badge {
                position: static;
                display: inline-block;
                margin-bottom: 0.75rem;
            }
            
            .pub-card {
                padding: 1.25rem;
            }
            
            .pub-actions {
                flex-direction: column;
            }
            
            .pub-btn {
                justify-content: center;
            }
        }

        @media (min-width: 768px) {
            .pub-controls {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }
        /* ========================================
        COLLABORATORS SECTION
        ======================================== */

        .collaborators-section {
            padding: 5rem 0;
            background: var(--bg);
        }

        /* Stats Bar */
        .collab-stats {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 2rem;
            margin-bottom: 3rem;
            padding: 1.5rem 2rem;
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .collab-stat {
            text-align: center;
        }

        .collab-stat-num {
            display: block;
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
            line-height: 1;
        }

        .collab-stat-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Collaborator Grid */
        .collab-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        /* Collaborator Card */
        .collab-card {
            display: flex;
            gap: 1.25rem;
            padding: 1.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
        }

        .collab-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-color: var(--accent);
        }

        /* Photo */
        .collab-photo {
            position: relative;
            flex-shrink: 0;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            background: linear-gradient(135deg, var(--primary), var(--accent));
        }

        .collab-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .collab-photo-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            font-size: 2rem;
        }

        /* Info */
        .collab-info {
            flex: 1;
            min-width: 0;
        }

        .collab-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 0.25rem;
            line-height: 1.3;
        }

        .collab-role {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 0.25rem;
        }

        .collab-institution {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
        }

        .collab-institution i {
            margin-right: 0.4rem;
            color: var(--accent);
        }

        /* Focus Tags */
        .collab-focus {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            margin-bottom: 0.75rem;
        }

        .focus-tag {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            background: rgba(78, 205, 196, 0.1);
            color: var(--accent);
            border-radius: 4px;
            border: 1px solid rgba(78, 205, 196, 0.3);
        }

        /* Meta (joint papers) */
        .collab-meta {
            margin-bottom: 0.5rem;
        }

        .joint-papers {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .joint-papers i {
            margin-right: 0.3rem;
            color: var(--accent);
        }

        /* Links */
        .collab-links {
            display: flex;
            gap: 0.5rem;
        }

        .collab-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--bg);
            color: var(--text-muted);
            font-size: 0.85rem;
            transition: all 0.2s;
            border: 1px solid var(--border);
        }

        .collab-links a:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Institution Logos */
        .collab-institutions {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .collab-institutions h3 {
            font-size: 1rem;
            color: var(--text-muted);
            margin-bottom: 1.5rem;
            font-weight: 500;
        }

        .institution-logos {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 2rem;
        }

        .institution-logos img {
            height: 40px;
            width: auto;
            opacity: 0.7;
            filter: grayscale(100%);
            transition: all 0.3s;
        }

        .institution-logos img:hover {
            opacity: 1;
            filter: grayscale(0%);
        }

        /* Research Themes */
        .themes-section {
            text-align: center;
        }

        .themes-section h3 {
            font-size: 1.25rem;
            color: var(--text);
            margin-bottom: 1.5rem;
        }

        .theme-clusters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .theme-card {
            padding: 1.5rem;
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border);
            border-top: 3px solid var(--theme-color);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .theme-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .theme-icon {
            font-size: 1.5rem;
            color: var(--theme-color);
            margin-bottom: 0.75rem;
        }

        .theme-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 0.5rem;
        }

        .theme-keywords {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
        }

        .theme-count {
            font-size: 0.75rem;
            color: var(--accent);
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .collab-grid {
                grid-template-columns: 1fr;
            }
            
            .collab-card {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .collab-focus {
                justify-content: center;
            }
            
            .collab-links {
                justify-content: center;
            }
            
            .collab-stats {
                gap: 1rem;
            }
            
            .collab-stat-num {
                font-size: 1.5rem;
            }
            
            .institution-logos {
                gap: 1.5rem;
            }
            
            .institution-logos img {
                height: 30px;
            }
        }
    </style>
    <script type="application/ld+json">
        {
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Dr. Marco-Felipe King",
        "jobTitle": "Lecturer in Building Engineering & Infection Transmission",
        "affiliation": {
            "@type": "Organization",
            "name": "University of Leeds"
        },
        "url": "https://marcofelipeking.com",
        "sameAs": [
            "https://scholar.google.com/citations?user=avLSE_oAAAAJ&hl=en",
            "https://twitter.com/MarcoFelipeKing",
            "https://www.linkedin.com/in/yourprofile"
        ],
        "knowsAbout": ["Computational Fluid Dynamics", "Infection Control", "Indoor Air Quality", "Bioaerosols"],
        "alumniOf": "University of Leeds"
        }
    </script>
</head>

<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <a href="#" class="nav-logo">MFK</a>
            <ul class="nav-links" id="navLinks">
                <li><a href="#about">About</a></li>
                <li><a href="#wpe">Leadership</a></li>
                <li><a href="#media">Visuals</a></li>
                <li><a href="#team">Team</a></li>
                <li><a href="#network">Network</a></li>
                <li><a href="#contact">Contact</a></li>
                <li>
                    <button class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i></button>
                </li>
            </ul>
            <button class="mobile-menu-btn" id="mobileMenuBtn"><i class="fas fa-bars"></i></button>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="hero-container">
            <div class="hero-content">
                <h1>Dr. Marco-Felipe King</h1>
                <p class="subtitle">Lecturer in Building Engineering & Infection Transmission at the University of Leeds.</p>
                <p>Pioneering research at the intersection of computational fluid dynamics, indoor air quality, and infection control to create healthier built environments.</p>
                
                <div class="hero-stats">
                    <div class="stat">
                        <span class="stat-number">1645+</span>
                        <span class="stat-label">Citations</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number">22</span>
                        <span class="stat-label">h-index</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number">45+</span>
                        <span class="stat-label">Publications</span>
                    </div>
                </div>
                
                <div class="hero-buttons">
                    <a href="#contact" class="btn btn-primary">
                        <i class="fas fa-envelope"></i> Contact Me
                    </a>
                    <a href="cv/MFK_CV_2025.pdf" target="_blank" class="btn btn-secondary">
                        <i class="fas fa-file-pdf"></i> Download CV
                    </a>
                    <a href="https://phd.leeds.ac.uk" target="_blank" class="btn btn-secondary" style="border:none; color: var(--accent);">
                        <i class="fas fa-user-graduate"></i> PhD Opportunities
                    </a>
                </div>
            </div>
            
            <div class="hero-image">
                <div class="hero-image-wrapper">
                    <img src="images/marco.JPEG" alt="Dr. Marco-Felipe King">
                </div>
            </div>
        </div>
    </section>

    <!-- TRUST BAR: Logos Section -->
    <div class="logo-strip">
        <div class="section-container">
            <p class="logo-text">Research affiliated with:</p>
            <div class="logo-grid">
                <!-- Ensure you save these images in your folder -->
                <a href="https://www.leeds.ac.uk"><img src="images/leeds_logo_black_on_white_bk.jpg" alt="University of Leeds" class="org-logo" title="University of Leeds"></a>
                <a href="https://www.wpe.leeds.ac.uk"><img src="images/wpe_logo.svg" alt="WPE Leeds" class="org-logo" title="Water, Public Health & Environmental Engineering"></a>
                <a href="https://www.ukieg.org"><img src="images/UKIEG.png" alt="UKIEG" class="org-logo" title="UK Indoor Environments Group"></a>
                <a href="https://www.healthybuildingsnetwork.org"><img src="images/hbn_landscape.png" alt="Health Buildings Network" class="org-logo" title="Health Buildings Network"></a>
                <a href="https://www.nhs.uk"><img src="images/nhs_logo.png" alt="NHS" class="org-logo" title="NHS"></a>
            </div>
        </div>
    </div>

    <!-- NEWS TICKER -->
    <div class="news-banner">
        <div class="news-container">
            <span class="news-label">Latest Talk:</span>
            <div class="news-item">
                <span class="news-date">Nov 2025</span>
                <span>Keynote Speaker at ASHRAE UK Chapter - London</span>
            </div>
            <div class="news-item">
                <span class="news-date">Sep 2025</span>
                <span>New paper published in Building & Environment on Far-UVC. Read it <a href="http://dx.doi.org/10.1016/j.buildenv.2025.112734" target="_blank">here</a>.</span>
            </div>
        </div>
    </div>

    <!-- About Section -->
    <section class="about" id="about">
        <div class="section-container">
            <div class="section-header">
                <h2>About Me</h2>
                <div class="section-divider"></div>
            </div>
            
            <div class="about-grid">
                <div class="about-content">
                    <p>I am a Lecturer in Building Engineering and Infection Transmission at the School of Civil Engineering, University of Leeds. My research focuses on understanding how infectious diseases spread through the built environment via air and surfaces and developing evidence-based strategies to reduce transmission risks. 
                        My background is mathematical and computational, with a focus on epidemiology and environmental engineering and work closely with companies on air cleaning technology and the real-world implementation in the NHS.</p>
                    
                    <!-- HBN CARD -->
                    <div class="hbn-card">
                        <h4><i class="fas fa-hospital-alt" style="color:#27ae60;"></i> Health Buildings Network Leeds</h4>
                        <span class="hbn-card-role">Co-Director</span>
                        <p>I recently discussed the future of hospital design and infection resilience in an exclusive interview with HBN Leeds.</p>
                        <a href="https://www.healthybuildingsnetwork.org/blog/interview_marco.html" target="_blank" class="hbn-link">
                            Read Full Interview <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                
                <div class="about-sidebar">
                    <!-- Key Roles Sidebar -->
                    <div class="highlight-item" style="display:flex; gap:1rem; margin-bottom:1.5rem;">
                        <i class="fas fa-users" style="color:var(--accent); font-size:1.5rem;"></i>
                        <div><h4>WPE Director</h4><p style="font-size:0.9rem; color:var(--text-muted);">Water, Public Health & Env. Eng.</p></div>
                    </div>
                    <div class="highlight-item" style="display:flex; gap:1rem; margin-bottom:1.5rem;">
                        <i class="fas fa-network-wired" style="color:var(--accent); font-size:1.5rem;"></i>
                        <div><h4>UKIEG Committee</h4><p style="font-size:0.9rem; color:var(--text-muted);">Webinar Coordinator</p></div>
                    </div>
                    <div class="highlight-item" style="display:flex; gap:1rem; margin-bottom:1.5rem;">
                        <i class="fas fa-heart" style="color:var(--accent); font-size:1.5rem;"></i>
                        <div><h4>HBN Co-Director</h4><p style="font-size:0.9rem; color:var(--text-muted);">Healthy Buildings Network</p></div>
                    </div>
                    <div class="highlight-item" style="display:flex; gap:1rem; margin-bottom:1.5rem;">
                        <i class="fas fa-award" style="color:var(--accent); font-size:1.5rem;"></i>
                        <div><h4>FHEA</h4><p style="font-size:0.9rem; color:var(--text-muted);">Fellow of HE Academy</p></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- NEW: WPE LEADERSHIP SECTION -->
    <section class="wpe-section" id="wpe">
        <div class="section-container">
            <div class="wpe-header">
                <h2>Academic Leadership</h2>
                <p><strong>Director</strong> of the Water, Public Health & Environmental Engineering (WPE) Research Group. Based in the School of Civil Engineering at the University of Leeds.</p>
            </div>
            
            <div class="wpe-stats">
                <div class="wpe-stat">
                    <span class="wpe-stat-num">15</span>
                    <span>Academics</span>
                </div>
                <div class="wpe-stat">
                    <span class="wpe-stat-num">50</span>
                    <span>PhD Researchers</span>
                </div>
                <div class="wpe-stat">
                    <span class="wpe-stat-num">2003</span>
                    <span>Est.</span>
                </div>
            </div>

            <div class="wpe-grid">
                <div class="wpe-card">
                    <i class="fas fa-wind"></i>
                    <h3>Indoor Air</h3>
                    <p>Researching pollutants, ventilation systems, and health impacts of indoor environments.</p>
                </div>
                <div class="wpe-card">
                    <i class="fas fa-recycle"></i>
                    <h3>BioResources</h3>
                    <p>Developing sustainable technologies for resource recovery and circular economy.</p>
                </div>
                <div class="wpe-card">
                    <i class="fas fa-heartbeat"></i>
                    <h3>Public Health</h3>
                    <p>Addressing environmental health challenges with evidence-based solutions.</p>
                </div>
                <div class="wpe-card">
                    <i class="fas fa-toilet"></i>
                    <h3>Sanitation</h3>
                    <p>Creating sustainable sanitation systems for improved global health outcomes.</p>
                </div>
                <div class="wpe-card">
                    <i class="fas fa-water"></i>
                    <h3>Water</h3>
                    <p>Water pathways and engineering solutions for global challenges.</p>
                </div>
            </div>
            
            <div style="text-align:center; margin-top:2rem;">
                <a href="https://wpeleeds.org" target="_blank" class="btn-wpe"> Explore WPE Research Group <i class="fas fa-arrow-right"></i> </a>
            </div>
        </div>
    </section>

    <!-- MEDIA / CFD VIDEOS SECTION -->
    <section id="media">
        <div class="section-container">
            <div class="section-header">
                <h2>Research in Motion</h2>
                <p>Visualising invisible risks through Computational Fluid Dynamics (CFD)</p>
                <div class="section-divider"></div>
            </div>

            <div class="media-grid">
                <!-- Video 1 -->
                <div class="video-card">
                    <div class="video-wrapper">
                        <!-- Replace with your actual YouTube ID -->
                        <iframe src="https://www.youtube.com/embed/aMNfqDXwF-Y" title="Hospital Ward Airflow" allowfullscreen loading="lazy"></iframe>
                    </div>
                    <div class="video-caption">
                        <h3><i class="fas fa-wind"></i> Hospital Ward Airflow</h3>
                        <p>High-fidelity simulation of particle dispersion from a cough in a four-bed hospital ward for demonstration purposes.</p>
                        
                    </div>
                </div>
                
                <!-- Video 2 -->
                <div class="video-card">
                    <div class="video-wrapper">
                        <iframe src="https://www.youtube.com/embed/VkKM9rOdays" title="Natural Ventilation" allowfullscreen loading="lazy"></iframe>
                    </div>
                    <div class="video-caption">
                        <h3><i class="fas fa-virus"></i> Smoke Tracer</h3>
                        <p>Visualising the movement of air in a 6-bed Nightingale ward.</p>
                    </div>
                </div>
                <!-- Video 3 -->
                <div class="video-card">
                    <div class="video-wrapper">
                        <iframe src="https://www.youtube.com/embed/lLXdHS4rG5s?si=hMq1RJzWEnG46VrT" title="Airflow Around Cubes" allowfullscreen loading="lazy"></iframe>
                    </div>
                    <div class="video-caption">
                        <h3><i class="fas fa-computer"></i>Lattice-Boltzmann Method</h3>
                        <p>Lattice-Boltzmann simulations of airflow around obstacles on GPU.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

<!-- COLLABORATORS SECTION -->
<section class="collaborators-section" id="collaborators">
    <div class="section-container">
        <div class="section-header">
            <h2>Research Collaborators</h2>
            <p>Building healthier environments through interdisciplinary partnerships</p>
            <div class="section-divider"></div>
        </div>

        <!-- Stats Bar -->
        <div class="collab-stats">
            <div class="collab-stat">
                <span class="collab-stat-num">60+</span>
                <span class="collab-stat-label">Collaborators</span>
            </div>
            <div class="collab-stat">
                <span class="collab-stat-num">40+</span>
                <span class="collab-stat-label">Joint Papers</span>
            </div>
            <div class="collab-stat">
                <span class="collab-stat-num">15+</span>
                <span class="collab-stat-label">Institutions</span>
            </div>
            <div class="collab-stat">
                <span class="collab-stat-num">8</span>
                <span class="collab-stat-label">Countries</span>
            </div>
        </div>

        <!-- Featured Collaborators Grid -->
        <div class="collab-grid">

            <!-- Collaborator 1 -->
            <div class="collab-card">
                <div class="collab-photo">
                    <img src="images/collaborators/cath.jpeg" alt="Prof. Catherine Noakes">
                </div>
                <div class="collab-info">
                    <h3 class="collab-name">Prof. Catherine Noakes</h3>
                    <p class="collab-role">Professor of Environmental Engineering for Buildigs</p>
                    <p class="collab-institution">
                        <i class="fas fa-university"></i> University of Leeds
                    </p>
                    <div class="collab-focus">
                        <span class="focus-tag">CFD</span>
                        <span class="focus-tag">Infection Control</span>
                        <span class="focus-tag">Ventilation</span>
                        <span class="focus-tag">Building Performance</span>
                    </div>
                    <div class="collab-meta">
                        <span class="joint-papers">
                            <i class="fas fa-file-alt"></i> 25+ joint papers
                        </span>
                    </div>
                    <div class="collab-links">
                        <a href="https://scholar.google.com/citations?user=aclEEm8AAAAJ&hl=en" target="_blank" title="Google Scholar">
                            <i class="fas fa-graduation-cap"></i>
                        </a>
                        <a href="https://eps.leeds.ac.uk/civil-engineering/staff/169/professor-catherine-noakes" target="_blank" title="University Profile">
                            <i class="fas fa-user"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Collaborator 2 -->
            <div class="collab-card">
                <div class="collab-photo">
                    <img src="images/collaborators/andy.jpeg" alt="Prof. Andrew Sleigh">
                </div>
                <div class="collab-info">
                    <h3 class="collab-name">Prof. Andrew Sleigh</h3>
                    <p class="collab-role">Professor of Fluid Dynamics</p>
                    <p class="collab-institution">
                        <i class="fas fa-university"></i> University of Leeds
                    </p>
                    <div class="collab-focus">
                        <span class="focus-tag">CFD</span>
                        <span class="focus-tag">Lattice Boltzmann</span>
                    </div>
                    <div class="collab-meta">
                        <span class="joint-papers">
                            <i class="fas fa-file-alt"></i> 18 joint papers
                        </span>
                    </div>
                    <div class="collab-links">
                        <a href="#" target="_blank" title="Google Scholar">
                            <i class="fas fa-graduation-cap"></i>
                        </a>
                        <a href="#" target="_blank" title="University Profile">
                            <i class="fas fa-user"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Collaborator 3 -->
            <div class="collab-card">
                <div class="collab-photo">
                    <img src="images/collaborators/louise.jpeg" alt="Dr. Louise Fletcher">
                </div>
                <div class="collab-info">
                    <h3 class="collab-name">Dr. Louise Fletcher</h3>
                    <p class="collab-role">Associate Professor</p>
                    <p class="collab-institution">
                        <i class="fas fa-university"></i> University of Leeds
                    </p>
                    <div class="collab-focus">
                        <span class="focus-tag">Bioaerosols</span>
                        <span class="focus-tag">UV Disinfection</span>
                    </div>
                    <div class="collab-meta">
                        <span class="joint-papers">
                            <i class="fas fa-file-alt"></i> 15 joint papers
                        </span>
                    </div>
                    <div class="collab-links">
                        <a href="#" target="_blank" title="Google Scholar">
                            <i class="fas fa-graduation-cap"></i>
                        </a>
                        <a href="#" target="_blank" title="University Profile">
                            <i class="fas fa-user"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Collaborator 4 -->
            <div class="collab-card">
                <div class="collab-photo">
                    <img src="images/collaborators/amanda.jpeg" alt="Assistant Prof. Amanda Wilson">
                </div>
                <div class="collab-info">
                    <h3 class="collab-name">Assistant Prof. Amanda Wilson</h3>
                    <p class="collab-role">Professor of Medical Engineering</p>
                    <p class="collab-institution">
                        <i class="fas fa-university"></i> University of Arizona
                    </p>
                    <div class="collab-focus">
                        <span class="focus-tag">Hospital Design</span>
                        <span class="focus-tag">Surface Infection Transmission</span>
                    </div>
                    <div class="collab-meta">
                        <span class="joint-papers">
                            <i class="fas fa-file-alt"></i> 12 joint papers
                        </span>
                    </div>
                    <div class="collab-links">
                        <a href="#" target="_blank" title="Google Scholar">
                            <i class="fas fa-graduation-cap"></i>
                        </a>
                        <a href="#" target="_blank" title="University Profile">
                            <i class="fas fa-user"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Collaborator 5 -->
            <div class="collab-card">
                <div class="collab-photo">
                    <img src="images/collaborators/janet.jpeg" alt="Prof. Janet Barlow">
                </div>
                <div class="collab-info">
                    <h3 class="collab-name">Prof. Goodarz Ahmadi</h3>
                    <p class="collab-role">Professor of Environmental Physics</p>
                    <p class="collab-institution">
                        <i class="fas fa-university"></i> University of Reading
                    </p>
                    <div class="collab-focus">
                        <span class="focus-tag">Atmospheric Physics</span>
                        <span class="focus-tag">Measurement</span>
                    </div>
                    <div class="collab-meta">
                        <span class="joint-papers">
                            <i class="fas fa-file-alt"></i> 8 joint papers
                        </span>
                    </div>
                    <div class="collab-links">
                        <a href="https://www.linkedin.com/in/janet-f-barlow-ab636512" target="_blank" title="Google Scholar">
                            <i class="fas fa-graduation-cap"></i>
                        </a>
                        <a href="https://research.reading.ac.uk/meteorology/people/janet-barlow/" target="_blank" title="University Profile">
                            <i class="fas fa-user"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Collaborator 6 -->
            <div class="collab-card">
                <div class="collab-photo">
                    <img src="images/collaborators/nan.jpeg" alt="Nan Zhang">
                    <div class="collab-photo-overlay">
                        <i class="fas fa-university"></i>
                    </div>
                </div>
                <div class="collab-info">
                    <h3 class="collab-name">Dr. Nan Zhang</h3>
                    <p class="collab-role">Infection Prevention Teams</p>
                    <p class="collab-institution">
                        <i class="fas fa-university"></i> Leeds Teaching Hospitals
                    </p>
                    <div class="collab-focus">
                        <span class="focus-tag">Clinical Translation</span>
                        <span class="focus-tag">Real-world Testing</span>
                    </div>
                    <div class="collab-meta">
                        <span class="joint-papers">
                            <i class="fas fa-file-alt"></i> 10+ joint papers
                        </span>
                    </div>
                    <div class="collab-links">
                        <a href="https://scholar.google.com/citations?user=fyezxckAAAAJ&hl=zh-CN" target="_blank" title="Google Scholar">
                            <i class="fas fa-graduation-cap"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Collaborator 7 -->
            <div class="collab-card">
                <div class="collab-photo">
                    <img src="images/collaborators/chuck.jpeg" alt="Chuck Gerba">
                    <div class="collab-photo-overlay">
                        <i class="fas fa-university"></i>
                    </div>
                </div>
                <div class="collab-info">
                    <h3 class="collab-name">Prof. Charles Gerba</h3>
                    <p class="collab-role">Infection Prevention Teams</p>
                    <p class="collab-institution">
                        <i class="fas fa-university"></i> University of Arizona
                    </p>
                    <div class="collab-focus">
                        <span class="focus-tag">Clinical Translation</span>
                        <span class="focus-tag">Real-world Testing</span>
                    </div>
                    <div class="collab-meta">
                        <span class="joint-papers">
                            <i class="fas fa-file-alt"></i> 3+ joint papers
                        </span>
                    </div>
                    <div class="collab-links">
                        <a href="https://scholar.google.com/citations?user=fyezxckAAAAJ&hl=zh-CN" target="_blank" title="Google Scholar">
                            <i class="fas fa-graduation-cap"></i>
                        </a>
                    </div>
                </div>
            </div>

        </div>

        <!-- Institution Logos -->
        <div class="collab-institutions">
            <h3>Institutional Partners</h3>
            <div class="institution-logos">
                <img src="images/leeds_logo_black_on_white_bk.jpg" alt="University of Leeds" title="University of Leeds">
                <img src="images/nhs_logo.png" alt="NHS" title="NHS">
                <img src="images/collaborators/clarkson.png" alt="Clarkson University" title="Clarkson University">
                <img src="images/collaborators/sheffield.png" alt="University of Sheffield" title="University of Sheffield">
                <img src="images/collaborators/manchester.png" alt="University of Manchester" title="University of Manchester">
                <img src="images/collaborators/arizona.png" alt="University of Arizona" title="University of Arizona">
            </div>
        </div>

        <!-- Research Themes (keep from your original) -->
        <div class="themes-section">
            <h3>Research Themes</h3>
            <div class="theme-clusters">
                <div class="theme-card" style="--theme-color: #4ECDC4">
                    <div class="theme-icon"><i class="fas fa-virus"></i></div>
                    <div class="theme-title">Infection Control</div>
                    <div class="theme-keywords">COVID-19  Bioaerosols  SARS-CoV-2</div>
                    <div class="theme-count">25 papers</div>
                </div>
                <div class="theme-card" style="--theme-color: #FF6B6B">
                    <div class="theme-icon"><i class="fas fa-hospital"></i></div>
                    <div class="theme-title">Hospital Environments</div>
                    <div class="theme-keywords">Ventilation  Indoor Air  Surfaces</div>
                    <div class="theme-count">18 papers</div>
                </div>
                <div class="theme-card" style="--theme-color: #95E1D3">
                    <div class="theme-icon"><i class="fas fa-wind"></i></div>
                    <div class="theme-title">Computational Fluid Dynamics</div>
                    <div class="theme-keywords">CFD  Lattice Boltzmann  Urban Flow</div>
                    <div class="theme-count">22 papers</div>
                </div>
                <div class="theme-card" style="--theme-color: #FFD93D">
                    <div class="theme-icon"><i class="fas fa-shield-alt"></i></div>
                    <div class="theme-title">Prevention & Mitigation</div>
                    <div class="theme-keywords">Masks  Hand Hygiene  Risk Assessment</div>
                    <div class="theme-count">15 papers</div>
                </div>
            </div>
        </div>

    </div>
</section>

    <!-- TEAM SECTION -->
    <section class="team-section" id="team">
        <div class="section-container">
            <div class="section-header">
                <h2>PhD Research Group</h2>
                <p>Mentoring the next generation of engineers and scientists</p>
                <div class="section-divider"></div>
            </div>

            <div class="team-grid">
                <!-- Student 1 -->
                <div class="team-member">
                    <!-- Use images/student1.jpg -->
                    <img src="images/xiaoxuan.jpg" alt="Xiaoxuan Qin" class="member-photo">
                    <h3 class="member-name">Xiaoxuan Qin</h3>
                    <p class="member-topic">PhD Candidate</p>
                    <p class="member-bio">Modelling Surface Transfer and Infection Transmission.</p>
                </div>
                <!-- Student 2 -->
                <div class="team-member">
                    <img src="images/anushi.jpg" alt="Anushi Khandare" class="member-photo">
                    <h3 class="member-name">Anushi Khandare</h3>
                    <p class="member-topic">PhD Candidate</p>
                    <p class="member-bio">Surface contamination networks in airport terminals.</p>
                </div>
                <!-- Student 3 -->
                <div class="team-member">
                    <img src="images/student_placeholder.jpg" alt="Danny Blundell" class="member-photo">
                    <h3 class="member-name">Danny Blundell</h3>
                    <p class="member-topic">Post-Doc Researcher</p>
                    <p class="member-bio">HECOIRA project lead on hospital ventilation design.</p>
                </div>
                <!-- Student 4 -->
                <div class="team-member">
                    <img src="images/student_placeholder.jpg" alt="Rebecca Sale" class="member-photo">
                    <h3 class="member-name">Rebecca Sale</h3>
                    <p class="member-topic">PhD Candidate</p>
                    <p class="member-bio">Managing at home in times of crisis: how climate, COVID-19 and cost of living crises intersect in everyday life.</p>
                </div>
                <!-- Student 5 -->
                <div class="team-member">
                    <img src="images/ciara.jpg" alt="Ciara Higham" class="member-photo">
                    <h3 class="member-name">Ciara Higham</h3>
                    <p class="member-topic">PDRA</p>
                    <p class="member-bio">Characterising a time-dependent automatic microorganisms sampler: AMPAS</p>
                </div>
            </div>
            <div class="team-grid">
                <!-- Student 1 -->
                <div class="team-member">
                    <!-- Use images/student1.jpg -->
                    <img src="images/bushra.png" alt="Bushra Hasan" class="member-photo">
                    <h3 class="member-name">Bushra Hasan</h3>
                    <p class="member-topic">PhD Completed</p>
                    <p class="member-bio">Investigating the influence of user behaviours and toilet design on SARS-CoV-2 exposure in shared sanitation facilities.</p>
                </div>
                <!-- Student 2 -->
                <div class="team-member">
                    <img src="images/jemma.jpg" alt="Jemma Phillips" class="member-photo">
                    <h3 class="member-name">Jemma Phillips</h3>
                    <p class="member-topic">PhD Completed</p>
                    <p class="member-bio">Characterising gastrointestinal pathogen exposure from distal and proximal sources in New Delhi.</p>
                </div>
                <!-- Student 3 -->
                <div class="team-member">
                    <img src="images/alex.jpg" alt="Alexander Edwards" class="member-photo">
                    <h3 class="member-name">Alexander Edwards</h3>
                    <p class="member-topic">PhD Completed</p>
                    <p class="member-bio">Evaluating infection risk in hospital multi-bed wards using Wells-Riley.</p>
                </div>
                <!-- Student 4 -->
                <div class="team-member">
                    <img src="images/waseem.jpg" alt="Waseem Hiwar" class="member-photo">
                    <h3 class="member-name">Waseem Hiwar</h3>
                    <p class="member-topic">PhD Completed</p>
                    <p class="member-bio">Characterisation of bioaerosols in hospital patient wards.</p>
                </div>
                <!-- Student 5 -->
                <div class="team-member">
                    <img src="images/yoonhee.jpg" alt="Yoonhee Jung" class="member-photo">
                    <h3 class="member-name">Yoonhee Jung</h3>
                    <p class="member-topic">PhD University of Arizona</p>
                    <p class="member-bio">Risk-risk tradeoffs and risk-perception study associated with cleaning and disinfection (C&D) using green products.</p>
                </div>
            </div>
        </div>
                <!-- Student FAQ Accordion -->
        <div class="faq-container" style="max-width: 800px; margin: 3rem auto 0;">
            <h3 style="text-align:center; margin-bottom:1.5rem; color:var(--primary);">Information for Prospective PhDs</h3>
            
            <div class="faq-item">
                <button class="faq-question">
                    <span>Are you currently accepting PhD students?</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="faq-answer">
                    <p>Yes, I am looking for motivated students for the 2025/26 academic year. I am particularly interested in candidates with backgrounds in Fluid Dynamics, Applied Mathematics, or Civil Engineering.</p>
                </div>
            </div>

            <div class="faq-item">
                <button class="faq-question">
                    <span>What technical skills do I need?</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="faq-answer">
                    <p>My research is computationally intensive. Experience with CFD (OpenFOAM, Ansys) or programming (Python, C++, Matlab) is highly desirable. However, I also supervise experimental projects where lab skills are prioritised.</p>
                </div>
            </div>

            <div class="faq-item">
                <button class="faq-question">
                    <span>Is funding available?</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="faq-answer">
                    <p>Funding is competitive. I support applications for EPSRC DTP scholarships and University of Leeds research scholarships. If you have self-funding or government sponsorship, please state this clearly in your initial email.</p>
                </div>
            </div>
        </div>

        <style>
            .faq-item { border-bottom: 1px solid var(--border); }
            .faq-question { width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; background: none; border: none; font-size: 1rem; font-weight: 600; color: var(--text); cursor: pointer; text-align: left; }
            .faq-answer { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; color: var(--text-light); font-size: 0.95rem; }
            .faq-item.active .faq-answer { max-height: 200px; padding-bottom: 1rem; }
            .faq-item.active i { transform: rotate(180deg); }
        </style>

        <script>
            document.querySelectorAll('.faq-question').forEach(button => {
                button.addEventListener('click', () => {
                    const item = button.parentElement;
                    item.classList.toggle('active');
                });
            });
        </script>
    </section>

    <!-- PUBLICATIONS SECTION -->
    <section class="publications-section" id="publications">
        <div class="section-container">
            <div class="section-header">
                <h2>Selected Publications</h2>
                <p>Key peer-reviewed research outputs  
                    <a href="https://scholar.google.com/citations?user=avLSE_oAAAAJ&hl=es" target="_blank" style="color: var(--accent);">
                        view full list on Google Scholar
                    </a>
                </p>
                <div class="section-divider"></div>
            </div>

            <!-- Controls: populated by JS -->
            <div class="pub-controls">
                <div class="pub-search">
                    <i class="fas fa-search"></i>
                    <input type="text" id="pubSearch" placeholder="Search publications...">
                </div>
                <div class="pub-filters" id="pubFilters">
                    <!-- Filter buttons inserted here by JS -->
                </div>
            </div>

            <!-- Loading state -->
            <div id="pubLoading" class="pub-loading">
                <i class="fas fa-spinner fa-spin"></i> Loading publications...
            </div>

            <!-- Publications list: populated by JS -->
            <div class="pub-list" id="pubList"></div>

            <!-- Footer -->
            <div class="pub-footer">
                <p class="pub-updated" id="pubUpdated"></p>
                <a href="https://scholar.google.com/citations?user=avLSE_oAAAAJ&hl=es" target="_blank" class="btn btn-primary">
                    <i class="fas fa-graduation-cap"></i> View All Publications
                </a>
            </div>
        </div>
    </section>
    <!-- Contact Section -->
    <section class="contact" id="contact">
        <div class="section-container">
            <div class="section-header">
                <h2>Get in Touch</h2>
                <p>Interested in collaboration, supervision, or just want to chat about healthy buildings?</p>
                <div class="section-divider" style="background: rgba(255,255,255,0.5);"></div>
            </div>
            <div style="display:flex; justify-content:center; gap:2rem; flex-wrap:wrap;">
                <div class="contact-card">
                    <i class="fas fa-envelope" style="font-size:2rem; margin-bottom:1rem;"></i>
                    <h3>Email</h3>
                    <a href="mailto:m.f.king@leeds.ac.uk" style="color:white;">m.f.king@leeds.ac.uk</a>
                </div>
                <div class="contact-card">
                    <i class="fas fa-map-marker-alt" style="font-size:2rem; margin-bottom:1rem;"></i>
                    <h3>Office</h3>
                    <p>School of Civil Engineering<br>University of Leeds</p>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="footer-social" style="display:flex; justify-content:center; margin-bottom:1rem;">
            <a href="https://scholar.google.com/citations?user=avLSE_oAAAAJ&hl=es"><i class="fas fa-graduation-cap"></i></a>
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="https://linkedin.com/in/marco-felipe-king-b6683a35"><i class="fab fa-linkedin-in"></i></a>
        </div>
        <!-- Media Kit Mini-Section -->
        <div style="background: var(--bg-card); border-top: 1px solid var(--border); padding: 2rem 0; margin-top: 4rem;">
            <div class="section-container" style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:2rem;">
                <div>
                    <h4 style="color:var(--primary); margin-bottom:0.5rem;">Media & Event Organisers</h4>
                    <p style="font-size:0.9rem; color:var(--text-muted);">Need materials for a conference programme or press release?</p>
                </div>
                <div style="display:flex; gap:1rem;">
                    <a href="images/MFK_2025.jpg" download class="btn btn-secondary" style="font-size:0.85rem; padding: 0.5rem 1rem;">
                        <i class="fas fa-camera"></i> High-Res Photo
                    </a>
                    <a href="assets/bio/bio_text.txt" download class="btn btn-secondary" style="font-size:0.85rem; padding: 0.5rem 1rem;">
                        <i class="fas fa-file-alt"></i> Short Bio (TXT)
                    </a>
                </div>
            </div>
        </div>
        <p style="color:var(--text-muted); font-size:0.9rem;"> 2025 Dr. Marco-Felipe King.</p>
    </footer>

    <!-- JS Logic -->
<script>
    // --- 1. GLOBAL VARIABLES & THEME LOGIC ---
    let networkChart = null;
    let wordCloudChart = null;

    const html = document.documentElement;
    const themeToggle = document.getElementById('themeToggle');
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const navLinks = document.getElementById('navLinks');

    // Theme Toggle
    themeToggle.addEventListener('click', () => {
        const current = html.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-theme', next);
        themeToggle.querySelector('i').className = next === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        
        // Re-render charts with new theme colors
        if(networkChart) { networkChart.dispose(); }
        if(wordCloudChart) { wordCloudChart.dispose(); }
        initCharts(); 
    });

    // Mobile Menu
    mobileMenuBtn.addEventListener('click', () => {
        navLinks.style.display = navLinks.style.display === 'flex' ? 'none' : 'flex';
        if(window.innerWidth <= 768) {
            navLinks.style.flexDirection = 'column';
            navLinks.style.position = 'absolute';
            navLinks.style.top = '100%';
            navLinks.style.left = '0';
            navLinks.style.right = '0';
            navLinks.style.background = 'var(--bg)'; // Assumes you have this CSS var
            navLinks.style.padding = '1rem';
        }
    });

    // --- 2. DATASETS ---
    
    // Full CSV Data derived from your bibliography
const networkCsvData = `source,target,weight,year
King Marco-Felipe,Noakes Catherine J,59,2025
King Marco-Felipe,Lpez-Garca Martn,21,2024
King Marco-Felipe,Sleigh P Andrew,18,2022
King Marco-Felipe,Gough Hannah L,16,2020
King Marco-Felipe,Wilson Amanda M,15,2022
King Marco-Felipe,Barlow Janet F,14,2020
King Marco-Felipe,Fletcher Louise A,12,2025
King Marco-Felipe,Dancer Stephanie J,11,2022
King Marco-Felipe,Halios Christos H,10,2020
King Marco-Felipe,Reynolds Kelly A,9,2021
King Marco-Felipe,Hiwar Waseem,8,2025
King Marco-Felipe,Khan Amirul,7,2020
King Marco-Felipe,Luo Zhiwen,7,2020
King Marco-Felipe,Weir Mark H,6,2022
King Marco-Felipe,Zhang Nan,6,2024
King Marco-Felipe,Clifton Ian J,5,2021
King Marco-Felipe,Proctor Jessica,5,2021
King Marco-Felipe,Miller Daniel,5,2024
King Marco-Felipe,Peckham Daniel,5,2024
King Marco-Felipe,Delbosc Nicolas,5,2018
King Marco-Felipe,Camargo-Valero Miller Alonso,4,2017
King Marco-Felipe,Hoxey Roger,4,2018
King Marco-Felipe,Grimmond C Sue B,4,2020
King Marco-Felipe,Robertson Adam,4,2017
King Marco-Felipe,Parker Simon T,4,2024
King Marco-Felipe,Edwards Alexander J,4,2024
King Marco-Felipe,Akande Oluwafemi K,3,2018
King Marco-Felipe,Quinn Andrew D,3,2020
King Marco-Felipe,Sexton Jonathan D,3,2021
King Marco-Felipe,Abney Sarah E,3,2021
King Marco-Felipe,Jones Rachael M,3,2021
King Marco-Felipe,Zhu Min,3,2024
King Marco-Felipe,Bale Sue,2,2016
King Marco-Felipe,Waters Liz,2,2016
King Marco-Felipe,Ibanga Ikpe E,2,2018
King Marco-Felipe,Steinberg Dave,2,2018
King Marco-Felipe,Snow Stephen,2,2019
King Marco-Felipe,Boyson Amy,2,2019
King Marco-Felipe,Wood Kenneth,2,2025
King Marco-Felipe,Eadie Ewan,2,2025
King Marco-Felipe,Pottage Thomas,2,2024
King Marco-Felipe,Fenwick Abigail,2,2024
King Marco-Felipe,D'Costa Wilhemina,2,2024
King Marco-Felipe,Brown Natalie F,2,2024
King Marco-Felipe,Yaxley Nicola,2,2024
King Marco-Felipe,Li Yuguo,2,2024
King Marco-Felipe,Xu Zhikang,2,2024
King Marco-Felipe,Bate Andrew M,2,2024
King Marco-Felipe,Miao Doudou,2,2024
King Marco-Felipe,McGill Grinne,2,2024
King Marco-Felipe,Burridge Henry C,2,2021
King Marco-Felipe,Tidswell Emma,2,2025
King Marco-Felipe,Zhuang Linan,2,2024
King Marco-Felipe,Matamoros-Veloza Adriana,2,2017
King Marco-Felipe,Adams CE,2,2018
King Marco-Felipe,Robertson C,2,2018
King Marco-Felipe,Benson Lee,2,2023
King Marco-Felipe,Hall Ian,2,2024`;

    // Keywords derived from your publication titles
    const wordCloudData = [
        {name: 'CFD', value: 100},
        {name: 'Bioaerosol', value: 95},
        {name: 'Hospital', value: 90},
        {name: 'Ventilation', value: 85},
        {name: 'Infection Risk', value: 80},
        {name: 'Indoor Air', value: 75},
        {name: 'COVID-19', value: 70},
        {name: 'SARS-CoV-2', value: 65},
        {name: 'Urban Flow', value: 60},
        {name: 'Surfaces', value: 55},
        {name: 'Masks', value: 50},
        {name: 'Hand Hygiene', value: 45},
        {name: 'Lattice Boltzmann', value: 40},
        {name: 'Transmission', value: 35},
        {name: 'Natural Vent', value: 30}
    ];

    // --- 3. HELPER FUNCTIONS ---

    function parseNetworkData(csv) {
        const lines = csv.trim().split('\n');
        const nodesMap = new Map();
        const links = [];
        const isDark = html.getAttribute('data-theme') === 'dark';
        
        // Colors based on theme
        const colorMain = isDark ? "#ff7070" : "#c23531"; 
        const colorCollab = isDark ? "#73c0de" : "#2f4554";
        const textColor = isDark ? "#eee" : "#333";

        for (let i = 1; i < lines.length; i++) {
            const parts = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/); 
            if(parts.length < 3) continue;

            const source = parts[0].trim();
            const target = parts[1].trim();
            const weight = parseInt(parts[2]);

            if (!nodesMap.has(source)) {
                nodesMap.set(source, { 
                    id: source, name: source, value: 0, 
                    itemStyle: { color: colorMain },
                    label: { show: true, position: 'top', color: textColor }
                });
            }
            if (!nodesMap.has(target)) {
                nodesMap.set(target, { 
                    id: target, name: target, value: 0,
                    itemStyle: { color: colorCollab },
                    label: { color: textColor }
                });
            }

            nodesMap.get(source).value += weight;
            nodesMap.get(target).value += weight;

            links.push({
                source: source,
                target: target,
                value: weight,
                lineStyle: { width: Math.sqrt(weight) } 
            });
        }

        const nodes = Array.from(nodesMap.values()).map(n => {
            const size = n.id.includes("King") ? 35 : Math.min(Math.max(n.value * 2, 8), 25);
            return {
                ...n,
                symbolSize: size,
                label: { show: n.value > 5 || n.id.includes("King"), color: textColor }
            };
        });

        return { nodes, links };
    }

    // --- 4. INIT CHARTS FUNCTION ---
    function initCharts() {
        const isDark = html.getAttribute('data-theme') === 'dark';
        const textColor = isDark ? "#eee" : "#333";

        // --- A. Network Chart ---
        const networkDom = document.getElementById('networkChart');
        if (networkDom) {
            networkChart = echarts.init(networkDom);
            const graphData = parseNetworkData(networkCsvData);

            networkChart.setOption({
                backgroundColor: 'transparent',
                tooltip: {
                    trigger: 'item',
                    backgroundColor: isDark ? 'rgba(50,50,50,0.9)' : 'rgba(255,255,255,0.9)',
                    textStyle: { color: textColor },
                    formatter: (params) => {
                        if (params.dataType === 'edge') return `${params.data.source} <-> ${params.data.target}<br/>Papers: ${params.value}`;
                        return `${params.name}<br/>Total Papers: ${params.value}`;
                    }
                },
                series: [{
                    type: 'graph',
                    layout: 'force',
                    data: graphData.nodes,
                    links: graphData.links,
                    roam: true,
                    label: { position: 'right', formatter: '{b}' },
                    force: { repulsion: 200, edgeLength: [40, 150] }
                }]
            });
        }

        // --- B. Word Cloud Chart ---
        const cloudDom = document.getElementById('wordCloudChart');
        if (cloudDom) {
            wordCloudChart = echarts.init(cloudDom);
            
            // Generate random colors
            const randomColor = () => {
                return 'rgb(' + [
                    Math.round(Math.random() * 160 + (isDark ? 80 : 0)),
                    Math.round(Math.random() * 160 + (isDark ? 80 : 0)),
                    Math.round(Math.random() * 160 + (isDark ? 80 : 0))
                ].join(',') + ')';
            };

            wordCloudChart.setOption({
                backgroundColor: 'transparent',
                tooltip: { show: true },
                series: [{
                    type: 'wordCloud',
                    shape: 'circle',
                    left: 'center', top: 'center',
                    width: '95%', height: '95%',
                    sizeRange: [12, 50],
                    rotationRange: [-45, 90],
                    rotationStep: 45,
                    gridSize: 8,
                    textStyle: {
                        fontFamily: 'sans-serif',
                        fontWeight: 'bold',
                        color: randomColor
                    },
                    data: wordCloudData
                }]
            });
        }
    }

    // --- 5. EXECUTE ON LOAD ---
    // Initialize charts immediately
    initCharts();

    // Handle Window Resize
    window.addEventListener('resize', () => {
        if(networkChart) networkChart.resize();
        if(wordCloudChart) wordCloudChart.resize();
    });

    // Add filtering capability
    let currentPeriod = 'all';
    let minCollabStrength = 2;

    function filterDataByPeriod(period) {
        // Parse your CSV and filter by year
        // Return filtered dataset
    }

    function createCollaboratorRanking(data) {
        const ranking = document.getElementById('collaboratorRanking');
        const sorted = data.sort((a, b) => b.value - a.value).slice(0, 15);
        const maxValue = sorted[0].value;
        
        ranking.innerHTML = sorted.map((collab, idx) => `
            <div class="collab-item">
                <div class="collab-rank">${idx + 1}</div>
                <div class="collab-info">
                    <div class="collab-name">${collab.name}</div>
                    <div class="collab-bar" style="width: ${(collab.value/maxValue)*100}%"></div>
                </div>
                <div class="collab-papers">${collab.value}</div>
            </div>
        `).join('');
    }

    // Timeline button interactivity
    document.querySelectorAll('.period-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelector('.period-btn.active').classList.remove('active');
            btn.classList.add('active');
            currentPeriod = btn.dataset.period;
            updateVisualizations(currentPeriod);
        });
    });

    // Strength filter
    document.getElementById('strengthFilter')?.addEventListener('input', (e) => {
        minCollabStrength = e.target.value;
        document.getElementById('minPapers').textContent = minCollabStrength;
        updateNetworkChart(minCollabStrength);
    });

    // Theme cards click interaction
    document.querySelectorAll('.theme-card').forEach(card => {
        card.addEventListener('click', () => {
            // Could filter network by theme keywords
            alert('Filter network by this theme!');
        });
    });
    const cards = document.querySelectorAll('.wpe-card');
    const observer = new IntersectionObserver(entries =>
        entries.forEach(entry => {
            if(entry.isIntersecting) entry.target.classList.add('visible');
                                }),
    { threshold: 0.2 });
    cards.forEach(card => observer.observe(card));

/* ========================================
   PUBLICATIONS - JSON + Dynamic Rendering
   ======================================== */

document.addEventListener('DOMContentLoaded', function() {
    
    const pubList = document.getElementById('pubList');
    const pubFilters = document.getElementById('pubFilters');
    const pubLoading = document.getElementById('pubLoading');
    const pubUpdated = document.getElementById('pubUpdated');
    const pubSearch = document.getElementById('pubSearch');
    
    let publicationsData = [];
    
    // ---- THIS IS THE KEY PART: Fetch the JSON ----
    fetch('data/publications.json')
        .then(response => {
            if (!response.ok) throw new Error('Failed to load publications');
            return response.json();
        })
        .then(data => {
            publicationsData = data.publications;
            renderFilters(data.filterCategories);
            renderPublications(publicationsData);
            
            if (data.lastUpdated) {
                pubUpdated.textContent = `Last updated: ${formatDate(data.lastUpdated)}`;
            }
            
            pubLoading.style.display = 'none';
        })
        .catch(error => {
            console.error('Error loading publications:', error);
            pubLoading.innerHTML = '<i class="fas fa-exclamation-circle"></i> Failed to load publications';
        });
    
    // ---- Render Filter Buttons ----
    function renderFilters(categories) {
        pubFilters.innerHTML = categories.map((cat, index) => `
            <button class="pub-filter-btn ${index === 0 ? 'active' : ''}" data-filter="${cat.id}">
                ${cat.label}
            </button>
        `).join('');
        
        // Add event listeners
        pubFilters.querySelectorAll('.pub-filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                pubFilters.querySelectorAll('.pub-filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                filterPublications(btn.dataset.filter);
            });
        });
    }
    
    // ---- Render Publications ----
    function renderPublications(pubs) {
        pubList.innerHTML = pubs.map(pub => createPubCard(pub)).join('');
        attachCardListeners();
    }
    
    // ---- Create Single Publication Card ----
    function createPubCard(pub) {
        const authorsHtml = pub.authors.map(a => 
            a.self ? `<span class="self">${a.name}</span>` : a.name
        ).join(', ');
        
        const tagsAttr = pub.tags ? pub.tags.join(' ') : '';
        const featuredClass = pub.featured ? 'featured' : '';
        const hasImageClass = pub.image ? '' : 'no-image';
        
        const citation = `${pub.authors.map(a => a.name).join(', ')} (${pub.year}). ${pub.title}. ${pub.journal}${pub.volume ? ', ' + pub.volume : ''}${pub.pages ? ', ' + pub.pages : ''}. https://doi.org/${pub.doi}`;
        
        return `
            <article class="pub-card ${featuredClass} ${hasImageClass}" data-tags="${tagsAttr} ${pub.featured ? 'featured' : ''}" data-id="${pub.id}">
                <div class="pub-image">
                    ${pub.badge ? `<span class="pub-badge"> ${pub.badge}</span>` : ''}
                    <span class="pub-year-badge">${pub.year}</span>
                    ${pub.image 
                        ? `<img src="${pub.image}" alt="${pub.title}" loading="lazy">`
                        : `<div class="pub-image-placeholder">
                                <i class="fas fa-file-alt"></i>
                                <span>${pub.journal.split(' ')[0]}</span>
                           </div>`
                    }
                </div>
                
                <div class="pub-content">
                    <h3 class="pub-title">
                        <a href="https://doi.org/${pub.doi}" target="_blank" rel="noopener">
                            ${pub.title}
                        </a>
                    </h3>
                    
                    <p class="pub-authors">${authorsHtml}</p>
                    
                    <p class="pub-venue">
                        <i class="fas fa-journal-whills"></i>
                        <span class="journal">${pub.journal}</span>${pub.volume ? `, ${pub.volume}` : ''}${pub.pages ? ` (${pub.pages})` : ''}
                    </p>
                    
                    ${pub.abstract ? `
                        <div class="pub-abstract">
                            <button class="abstract-toggle">
                                <i class="fas fa-chevron-down"></i> Abstract
                            </button>
                            <div class="abstract-content">
                                <p>${pub.abstract}</p>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="pub-metrics">
                        ${pub.citations ? `
                            <span class="pub-citations" title="Google Scholar citations">
                                <i class="fas fa-quote-right"></i> ${pub.citations} citations
                            </span>
                        ` : ''}
                        ${pub.openAccess ? `
                            <span class="pub-access open-access" title="Open Access">
                                <i class="fas fa-lock-open"></i> Open Access
                            </span>
                        ` : ''}
                    </div>
                    
                    <div class="pub-actions">
                        <a href="https://doi.org/${pub.doi}" target="_blank" class="pub-btn" rel="noopener">
                            <i class="fas fa-external-link-alt"></i> DOI
                        </a>
                        ${pub.pdf ? `
                            <a href="${pub.pdf}" target="_blank" class="pub-btn">
                                <i class="fas fa-file-pdf"></i> PDF
                            </a>
                        ` : ''}
                        <button class="pub-btn cite-btn" data-citation="${escapeHtml(citation)}">
                            <i class="fas fa-quote-left"></i> Cite
                        </button>
                    </div>
                </div>
            </article>
        `;
    }
    
    // ---- Attach Event Listeners to Cards ----
    function attachCardListeners() {
        // Abstract toggles
        document.querySelectorAll('.abstract-toggle').forEach(btn => {
            btn.addEventListener('click', () => {
                btn.parentElement.classList.toggle('open');
            });
        });
        
        // Citation copy buttons
        document.querySelectorAll('.cite-btn').forEach(btn => {
            btn.addEventListener('click', async () => {
                const citation = btn.dataset.citation;
                
                try {
                    await navigator.clipboard.writeText(citation);
                    showCopied(btn);
                } catch (err) {
                    // Fallback
                    const textarea = document.createElement('textarea');
                    textarea.value = citation;
                    textarea.style.cssText = 'position:fixed;opacity:0';
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    showCopied(btn);
                }
            });
        });
    }
    
    function showCopied(btn) {
        const original = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
        btn.classList.add('copied');
        setTimeout(() => {
            btn.innerHTML = original;
            btn.classList.remove('copied');
        }, 2000);
    }
    
    // ---- Filter Publications ----
    function filterPublications(filter) {
        const cards = document.querySelectorAll('.pub-card');
        
        cards.forEach(card => {
            const tags = card.dataset.tags || '';
            
            if (filter === 'all') {
                card.classList.remove('hidden');
            } else if (tags.includes(filter)) {
                card.classList.remove('hidden');
            } else {
                card.classList.add('hidden');
            }
        });
    }
    
    // ---- Search ----
    if (pubSearch) {
        pubSearch.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase().trim();
            
            // Reset filters to "All"
            pubFilters.querySelectorAll('.pub-filter-btn').forEach(b => b.classList.remove('active'));
            pubFilters.querySelector('[data-filter="all"]')?.classList.add('active');
            
            const cards = document.querySelectorAll('.pub-card');
            
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                
                if (query === '' || text.includes(query)) {
                    card.classList.remove('hidden');
                } else {
                    card.classList.add('hidden');
                }
            });
        });
    }
    
    // ---- Utilities ----
    function escapeHtml(str) {
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML.replace(/"/g, '&quot;');
    }
    
    function formatDate(dateStr) {
        const date = new Date(dateStr);
        return date.toLocaleDateString('en-GB', { 
            day: 'numeric', 
            month: 'long', 
            year: 'numeric' 
        });
    }
    
});
</script>
</body>
</html>